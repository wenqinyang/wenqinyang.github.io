(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{299:function(t,a,s){"use strict";s.r(a);var e=s(7),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"prometheus-与-grafana-监控告警"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-与-grafana-监控告警"}},[t._v("#")]),t._v(" Prometheus 与 Grafana 监控告警")]),t._v(" "),a("h2",{attrs:{id:"prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus"}},[t._v("#")]),t._v(" Prometheus")]),t._v(" "),a("h3",{attrs:{id:"什么是prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是prometheus"}},[t._v("#")]),t._v(" 什么是Prometheus？")]),t._v(" "),a("p",[t._v("Prometheus是一个开源系统监控和警报工具。Prometheus与Grafana强强联合可以组成强大的监控工具，用于收集、存储、查询和可视化应用程序和系统的指标数据。它最初由 SoundCloud 开发，并于2012年发布为开源项目。")]),t._v(" "),a("h3",{attrs:{id:"它有什么特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#它有什么特点"}},[t._v("#")]),t._v(" 它有什么特点?")]),t._v(" "),a("ul",[a("li",[t._v("Prometheus 是一个开源的系统监控和警报工具。")]),t._v(" "),a("li",[t._v("它通过拉取方式定期从各种目标（例如应用程序、数据库、操作系统）收集"),a("strong",[t._v("指标")]),t._v("数据。")]),t._v(" "),a("li",[t._v("Prometheus 提供了强大的查询语言 PromQL 来执行实时数据查询和聚合操作。")]),t._v(" "),a("li",[t._v("它还支持警报规则，可以在特定条件满足时触发警报通知。")])]),t._v(" "),a("h3",{attrs:{id:"什么指标-metrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么指标-metrics"}},[t._v("#")]),t._v(" 什么指标(metrics)?")]),t._v(" "),a("p",[t._v("metrics可以理解为：数字测量。时间序列意味着随着时间的推移记录变化。用户想要测量的内容因应用程序而异。对于 Web 服务器来说，它可能是请求时间，对于数据库来说，它可能是活动连接数或活动查询数等。指标在理解应用程序为何以某种方式运行方面发挥着重要作用。例如，当请求数量较多时，应用程序可能会变慢。如果您有请求计数指标，您可以找出原因并增加服务器数量来处理负载。")]),t._v(" "),a("h3",{attrs:{id:"我们为什么要用它而不是别的"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#我们为什么要用它而不是别的"}},[t._v("#")]),t._v(" 我们为什么要用它而不是别的？")]),t._v(" "),a("ul",[a("li",[t._v("简单易用：配置和部署相对简单，拥有用户友好的界面和直观的查询语言。")]),t._v(" "),a("li",[t._v("多维度数据模型：使用基于标签的多维度数据模型来存储和查询时间序列数据。")]),t._v(" "),a("li",[t._v("强大的查询语言：PromQL 作为 Prometheus 的查询语言，具有丰富的功能和强大的表达能力。")]),t._v(" "),a("li",[t._v("强大的告警系统：灵活而可靠的告警系统，能够根据自定义的规则检测和触发告警。")])]),t._v(" "),a("h3",{attrs:{id:"什么时候适合用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么时候适合用"}},[t._v("#")]),t._v(" 什么时候适合用？")]),t._v(" "),a("blockquote",[a("p",[t._v("Prometheus works well for recording any purely numeric time series. It fits both machine-centric monitoring as well as monitoring of highly dynamic service-oriented architectures. In a world of microservices, its support for multi-dimensional data collection and querying is a particular strength.")])]),t._v(" "),a("p",[t._v("Prometheus 非常适合记录任何纯数字时间序列。它既适合以机器为中心的监控，也适合高度动态的面向服务的架构的监控。在微服务的世界中，它对多维数据收集和查询的支持是一个特殊的优势。")]),t._v(" "),a("h3",{attrs:{id:"什么时候不适合用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么时候不适合用"}},[t._v("#")]),t._v(" 什么时候不适合用？")]),t._v(" "),a("blockquote",[a("p",[t._v("Prometheus values reliability. You can always view what statistics are available about your system, even under failure conditions. If you need 100% accuracy, such as for per-request billing, Prometheus is not a good choice as the collected data will likely not be detailed and complete enough.")])]),t._v(" "),a("p",[t._v("如果您需要 100% 的准确性，例如按请求计费，Prometheus 不是一个好的选择，因为收集的数据可能不够详细和完整。")]),t._v(" "),a("h3",{attrs:{id:"prometheus架构图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus架构图"}},[t._v("#")]),t._v(" Prometheus架构图")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/imgs/promethus/architecture.png"),alt:"architecture"}}),t._v(" "),a("h3",{attrs:{id:"prometheus的重要组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus的重要组件"}},[t._v("#")]),t._v(" Prometheus的重要组件")]),t._v(" "),a("h4",{attrs:{id:"prometheus-server-重要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-server-重要"}},[t._v("#")]),t._v(" Prometheus Server(重要)")]),t._v(" "),a("p",[t._v("Prometheus Server 是整个架构中的核心组件，它负责数据采集、存储、查询和报警等功能。Prometheus Server 定期从配置的目标（通常是被监控的应用程序）中获取指标数据，并将其存储在本地的时序数据库中。同时，Prometheus Server 还提供了灵活的查询语言 PromQL，用于对指标数据进行查询和分析。")]),t._v(" "),a("h4",{attrs:{id:"alertmanager-重要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alertmanager-重要"}},[t._v("#")]),t._v(" Alertmanager(重要)")]),t._v(" "),a("p",[t._v("Alertmanager 负责处理来自 Prometheus Server 的报警规则产生的报警通知。它支持对报警进行静默、去重、分组和路由等操作，并可以通过电子邮件、PagerDuty、Slack 等方式发送报警通知给相应的接收者。")]),t._v(" "),a("h4",{attrs:{id:"exporters-重要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exporters-重要"}},[t._v("#")]),t._v(" Exporters(重要)")]),t._v(" "),a("p",[t._v("Exporters 是负责从各种应用程序和系统中采集指标数据的组件。Prometheus 提供了许多官方 Exporters，如 Node Exporter（采集主机级别的指标）、JMX Exporter（采集 Java 应用程序的指标）等。此外，还有一些社区提供的 Exporters，用于采集其他各类应用程序和系统的指标数据。本次我们的示例docker-compose中使用的就是Node Exporter采集器。")]),t._v(" "),a("h4",{attrs:{id:"pushgateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pushgateway"}},[t._v("#")]),t._v(" Pushgateway")]),t._v(" "),a("p",[t._v("Pushgateway 允许临时性的指标数据从短期作业或批处理任务中被推送到 Prometheus Server。这在一些无法直接被抓取的情况下很有用，例如批处理任务的指标数据。Pushgateway 可以接收并暂时存储这些指标数据，然后由 Prometheus Server 从 Pushgateway 中获取并处理。")]),t._v(" "),a("h4",{attrs:{id:"grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grafana"}},[t._v("#")]),t._v(" Grafana")]),t._v(" "),a("p",[t._v("Grafana 是一个开源的数据可视化和仪表板工具，通常与 Prometheus 结合使用。Grafana 可以连接到 Prometheus Server，直接查询和展示 Prometheus 中的指标数据。通过 Grafana，用户可以创建漂亮、交互式的仪表板，用于监控和可视化 Prometheus 中的数据。")]),t._v(" "),a("h3",{attrs:{id:"server与alertmanager架构关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#server与alertmanager架构关系"}},[t._v("#")]),t._v(" Server与Alertmanager架构关系")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/imgs/promethus/serverAlertmanager.png"),alt:"serverAlertmanager"}}),t._v(" "),a("p",[t._v("在Prometheus中一条告警规则主要由以下几部分组成：")]),t._v(" "),a("ul",[a("li",[t._v("告警名称：用户需要为告警规则命名，当然对于命名而言，需要能够直接表达出该告警的主要内容。")]),t._v(" "),a("li",[t._v("告警规则：告警规则实际上主要由PromQL进行定义，其实际意义是当表达式（PromQL）查询结果持续多长时间（During）后出发告警。")])]),t._v(" "),a("h3",{attrs:{id:"alertmanager告警特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alertmanager告警特性"}},[t._v("#")]),t._v(" Alertmanager告警特性")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/imgs/promethus/alertmanager.png"),alt:"alertmanager"}}),t._v(" "),a("h4",{attrs:{id:"分组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分组"}},[t._v("#")]),t._v(" 分组：")]),t._v(" "),a("p",[t._v("分组机制可以将详细的告警信息合并成一个通知。在某些情况下，比如由于系统宕机导致大量的告警被同时触发，在这种情况下分组机制可以将这些被触发的告警合并为一个告警通知，避免一次性接受大量的告警通知，而无法对问题进行快速定位。")]),t._v(" "),a("h4",{attrs:{id:"抑制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#抑制"}},[t._v("#")]),t._v(" 抑制：")]),t._v(" "),a("p",[t._v("抑制是指当某一告警发出后，可以停止重复发送由此告警引发的其它告警的机制。")]),t._v(" "),a("h4",{attrs:{id:"静默"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静默"}},[t._v("#")]),t._v(" 静默：")]),t._v(" "),a("p",[t._v("静默提供了一个简单的机制可以快速根据标签对告警进行静默处理。如果接收到的告警符合静默的配置，Alertmanager则不会发送告警通知。")]),t._v(" "),a("h4",{attrs:{id:"路由匹配"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#路由匹配"}},[t._v("#")]),t._v(" 路由匹配：")]),t._v(" "),a("p",[t._v("每一个告警都会从配置文件中顶级的route进入路由树，需要注意的是顶级的route必须匹配所有告警(即不能有任何的匹配设置match和match_re)，每一个路由都可以定义自己的接受人以及匹配规则。默认情况下，告警进入到顶级route后会遍历所有的子节点，直到找到最深的匹配route，并将告警发送到该route定义的receiver中。")]),t._v(" "),a("h4",{attrs:{id:"通知模板"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通知模板"}},[t._v("#")]),t._v(" 通知模板：")]),t._v(" "),a("br"),t._v(" "),a("img",{attrs:{src:t.$withBase("/imgs/promethus/notice.png"),alt:"notice"}}),t._v(" "),a("h3",{attrs:{id:"promql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#promql"}},[t._v("#")]),t._v(" PromQL")]),t._v(" "),a("p",[t._v("PromQL 全称：Prometheus Query Language它有以下特点：")]),t._v(" "),a("ul",[a("li",[t._v("简洁易懂：PromQL 使用类似数学表达式的语法，易于理解和编写。它的主要目标是提供一种直观的方式来描述和计算时间序列数据。")]),t._v(" "),a("li",[t._v("时间序列选择：PromQL 允许根据指标名称和标签选择特定的时间序列。您可以使用花括号 {} 来过滤和匹配时间序列。")]),t._v(" "),a("li",[t._v("范围选择：PromQL 允许选择特定时间范围内的数据。您可以使用方括号 [] 和时间表达式来指定起始时间和结束时间。")]),t._v(" "),a("li",[t._v("聚合操作：PromQL 提供了许多聚合操作符，例如求和、平均值、最大值、最小值、计数等，以便对时间序列数据进行聚合计算。这些操作符可以对单个时间序列或多个时间序列进行计算。")])]),t._v(" "),a("h3",{attrs:{id:"常用promql函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用promql函数"}},[t._v("#")]),t._v(" 常用PromQL函数")]),t._v(" "),a("ol",[a("li",[t._v('计算时间序列的样本数量：count(http_requests_total{status_code="200"}[5m])')]),t._v(" "),a("li",[t._v("统计特定指标的平均值：avg(metric_name)")]),t._v(" "),a("li",[t._v("统计特定指标的最大值：max(metric_name)")]),t._v(" "),a("li",[t._v("统计特定指标的最小值：min(metric_name)")]),t._v(" "),a("li",[t._v("查询特定时间范围内的指标数据：metric_name[start_time:end_time]")]),t._v(" "),a("li",[t._v("计算特定指标在一段时间内(5分钟)的速率：rate(metric_name[5m])")]),t._v(" "),a("li",[t._v('根据标签过滤指标数据：metric_name{label_name="value"}')])]),t._v(" "),a("h3",{attrs:{id:"promql实际运用例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#promql实际运用例子"}},[t._v("#")]),t._v(" PromQL实际运用例子")]),t._v(" "),a("h4",{attrs:{id:"网关业务成功率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网关业务成功率"}},[t._v("#")]),t._v(" 网关业务成功率：")]),t._v(" "),a("div",{staticClass:"language-PromQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-promql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("irate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("trans_onlinepay_total"),a("span",{pre:!0,attrs:{class:"token context-labels"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[t._v('"success"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("5m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("irate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("trans_onlinepay_total"),a("span",{pre:!0,attrs:{class:"token context-labels"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[t._v('"all"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("2m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),t._v("\n")])])]),a("h4",{attrs:{id:"系统qps波动大于100"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#系统qps波动大于100"}},[t._v("#")]),t._v(" 系统QPS波动大于100%：")]),t._v(" "),a("div",{staticClass:"language-PromQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-promql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sum")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),a("span",{pre:!0,attrs:{class:"token vector-match"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("system")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("system_request_total"),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("2m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sum")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),a("span",{pre:!0,attrs:{class:"token vector-match"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("system")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("system_request_total"),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("2m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("offset")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("2m")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("and")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sum")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),a("span",{pre:!0,attrs:{class:"token vector-match"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("system")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("system_request_total"),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("2m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h4",{attrs:{id:"mq堆积"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mq堆积"}},[t._v("#")]),t._v(" MQ堆积")]),t._v(" "),a("div",{staticClass:"language-PromQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-promql"}},[a("code",[t._v("rabbitmq_queue_messages"),a("span",{pre:!0,attrs:{class:"token context-labels"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("queue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=~")]),a("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[t._v('"base.*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\n")])])]),a("h4",{attrs:{id:"redisusercpuhigh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redisusercpuhigh"}},[t._v("#")]),t._v(" RedisUserCpuHigh")]),t._v(" "),a("div",{staticClass:"language-PromQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-promql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("redis_cpu_user_seconds_total"),a("span",{pre:!0,attrs:{class:"token context-labels"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("job")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[t._v('"redis_exporter"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("5m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.4")]),t._v("\n")])])]),a("h4",{attrs:{id:"主机cpu使用率"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主机cpu使用率"}},[t._v("#")]),t._v(" 主机cpu使用率")]),t._v(" "),a("div",{staticClass:"language-PromQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-promql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("count")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("http_requests_total"),a("span",{pre:!0,attrs:{class:"token context-labels"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("status_code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[t._v('"200"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("5m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"grafana-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grafana-2"}},[t._v("#")]),t._v(" Grafana")]),t._v(" "),a("h3",{attrs:{id:"什么是grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是grafana"}},[t._v("#")]),t._v(" 什么是Grafana")]),t._v(" "),a("ul",[a("li",[t._v("Grafana 是一个开源的可视化平台，用于创建和共享动态仪表盘。")]),t._v(" "),a("li",[t._v("它支持多种数据源，包括 Prometheus、InfluxDB、Elasticsearch 等。")]),t._v(" "),a("li",[t._v("Grafana 提供了丰富的图表和面板，可以自定义呈现各种指标数据。")]),t._v(" "),a("li",[t._v("它具有灵活的告警通知机制，可以通过电子邮件、Slack 等方式发送警报通知。")])]),t._v(" "),a("h3",{attrs:{id:"grafana的优点是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grafana的优点是什么"}},[t._v("#")]),t._v(" Grafana的优点是什么？")]),t._v(" "),a("ul",[a("li",[t._v("多数据源支持：支持各种数据来源，如 Prometheus、InfluxDB、Elasticsearch 等。")]),t._v(" "),a("li",[t._v("强大的可视化能力：自定义仪表盘和图表，丰富的可视化选项。")]),t._v(" "),a("li",[t._v("实时监控和报警：通过设置阈值和规则进行告警，并及时通知相关人员。")]),t._v(" "),a("li",[t._v("插件生态系统：丰富的插件库，扩展 Grafana 的功能和数据源支持。")]),t._v(" "),a("li",[t._v("团队协作和共享：轻松共享和协作仪表盘，提高团队的工作效率。")])]),t._v(" "),a("h3",{attrs:{id:"grafana多数据源查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#grafana多数据源查询"}},[t._v("#")]),t._v(" Grafana多数据源查询")]),t._v(" "),a("ul",[a("li",[t._v("使用 Prometheus 数据源：")])]),t._v(" "),a("ol",[a("li",[t._v("查询 CPU 使用率：")])]),t._v(" "),a("div",{staticClass:"language-PromQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-promql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("avg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("irate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node_cpu_seconds_total"),a("span",{pre:!0,attrs:{class:"token context-labels"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[t._v('"idle"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("5m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token vector-match"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("查询网络传入流量：")])]),t._v(" "),a("div",{staticClass:"language-PromQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-promql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sum")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node_network_receive_bytes_total"),a("span",{pre:!0,attrs:{class:"token context-labels"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("job")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token label-value attr-value"}},[t._v('"node"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token context-range"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token range-duration number"}},[t._v("5m")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token vector-match"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token label-key attr-name"}},[t._v("instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),t._v("\n")])])]),a("ul",[a("li",[t._v("使用 Elasticsearch 数据源：")])]),t._v(" "),a("ol",[a("li",[t._v("查询 HTTP 请求时间：")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("GET /_search\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"query"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"bool"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"must"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"match"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"status"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"aggs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"avg_response_time"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"avg"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"field"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"response_time"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("查询日志关键字统计：")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("GET /_search\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"query"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"match"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"message"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"aggs"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"error_count"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value_count"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"field"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message.keyword"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"快速部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速部署"}},[t._v("#")]),t._v(" 快速部署")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/pages/dockerCompose/dockerCompose.html#prometheus"}},[t._v("点我查看")])],1),t._v(" "),a("h2",{attrs:{id:"prometheus和grafana落地"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus和grafana落地"}},[t._v("#")]),t._v(" Prometheus和Grafana落地")]),t._v(" "),a("h3",{attrs:{id:"监控架构图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控架构图"}},[t._v("#")]),t._v(" 监控架构图")]),t._v(" "),a("img",{attrs:{src:t.$withBase("/imgs/promethus/businessProcess.png"),alt:"businessProcess"}}),t._v(" "),a("h3",{attrs:{id:"监控指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控指标"}},[t._v("#")]),t._v(" 监控指标")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.yuque.com/wqyang/sqxlco/gmgzdfchhqwdw310",target:"_blank",rel:"noopener noreferrer"}},[t._v("思维导图点我"),a("OutboundLink")],1),t._v(" "),a("img",{attrs:{src:t.$withBase("/imgs/promethus/monitorMetrics.jpg"),alt:"monitor"}})]),t._v(" "),a("h3",{attrs:{id:"监控数据可视化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控数据可视化"}},[t._v("#")]),t._v(" 监控数据可视化")]),t._v(" "),a("p",[t._v("飞致云开源产品：DataEase\n"),a("a",{attrs:{href:"https://dataease.io/docs/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("点我查看"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"延伸"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#延伸"}},[t._v("#")]),t._v(" 延伸")]),t._v(" "),a("h3",{attrs:{id:"prometheus和skywalking可以碰出什么样的火花-点我查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus和skywalking可以碰出什么样的火花-点我查看"}},[t._v("#")]),t._v(" Prometheus和SkyWalking可以碰出什么样的火花？"),a("a",{attrs:{href:"https://blog.csdn.net/yuhouwucaihong/article/details/127503502",target:"_blank",rel:"noopener noreferrer"}},[t._v("点我查看"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);